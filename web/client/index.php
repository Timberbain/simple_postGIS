<html>
    <head>
        <?php
        echo '<link rel="stylesheet" href="js/dist/leaflet.css">';
        echo '<script type="text/javascript" src="js/dist/leaflet.js"></script>';

        echo '<!--script src="http://maps.google.com/maps/api/js?v=3.2&sensor=false"></script-->';
        echo '<!--script src="http://matchingnotes.com/javascripts/leaflet-google.js"></script-->';


        echo '<script type="text/javascript" src="dist/bundle.js"></script>';
        ?>
        <style>
            #map {
                height: 600px;
            }

        </style>

    </head>
    <body>

        <div id="map"></div>
        <br/>

        <?php

        require_once("ParensParser.php");


        $host = "host=postgres";
        $port = "port=5432";
        $dbname = "dbname=gis";
        $credentials = "user=postgis password=postpass";

        $db = pg_connect( "$host $port $dbname $credentials");
        if(!$db){
            echo "console.log('Error: Unable to open database');";
        } else {
            echo "console.log('Opened database successfully');";

        /*
            "id_0" numeric(10,0),
            "iso" varchar(3),
            "name_0" varchar(75),
            "id_1" numeric(10,0),
            "name_1" varchar(75),
            "id_2" numeric(10,0),
            "name_2" varchar(75),
            "hasc_2" varchar(15),
            "ccn_2" numeric(10,0),
            "cca_2" varchar(254),
            "type_2" varchar(50),
            "engtype_2" varchar(50),
            "nl_name_2" varchar(75),
            "varname_2" varchar(150),
            "geog" geography(MULTIPOLYGON,4326));
        */


            $query = "select name_2, hasc_2, ST_asText(geog) from swe_adm2";

            $result = pg_query($query);

            $geoJson = array(
                "type" => "FeatureCollection",
                "features" => array()
            );
            echo "<pre>";
            while($row = pg_fetch_row($result)){

                $geoJson["features"][] = array(
                    "type" => "Feature",
                    "geometry" => toGeoJson($row[2]),
                    "properties" => array(
                        "name" => $row[0],
                        "code" => $row[1]
                    )
                );
            }
            // $geoJson["features"][] = array(
            //     "type" => "Feature",
            //     "geometry" => toGeoJson(
            //         // "MULTIPOLYGON(((59.33 18.04, 59.34 18.04, 59.34 18.05, 59.33 18.05, 59.33 18.04))((59.43 18.14, 59.44 18.14, 59.44 18.15, 59.43 18.15, 59.43 18.14)))"
            //         "MULTIPOLYGON(
            //             (
            //                 (18.1304626464844 59.8025741577148,18.0867233276367 59.8028717041017,18.0538635253907 59.8150520324707,17.9920806884767 59.7893714904786,17.9357166290283 59.7920684814453,17.8528499603271 59.7496757507325,17.8074684143067 59.7477989196778,17.7596225738527 59.7502403259278,17.697889328003 59.7558021545411,17.6859531402588 59.783145904541,17.6250686645508 59.7644081115724,17.6095085144044 59.7461776733399,17.6051769256592 59.7356338500977,17.6021995544434 59.7355804443359,17.5932960510254 59.7354202270508,17.5936183929443 59.7309303283691,17.5847148895264 59.7307662963868,17.5758094787599 59.7306022644044,17.5761356353761 59.7261161804199,17.567232131958 59.7259483337402,17.5583286285401 59.7257843017579,17.5494251251222 59.7256202697754,17.5405216217041 59.7254524230958,17.5316181182862 59.7252845764161,17.5227165222169 59.7251167297364,17.5138111114502 59.7249488830568,17.5049095153809 59.7247810363769,17.4960060119629 59.7246093750001,17.487102508545 59.7244415283204,17.4782028198243 59.7242698669434,17.4692974090576 59.7240982055665,17.4603958129883 59.7239265441895,17.4514923095704 59.7237548828125,17.4511508941651 59.7282409667969,17.4422454833984 59.7280693054199,17.4333400726319 59.7278938293457,17.4244403839112 59.7277183532715,17.4155368804933 59.7275466918945,17.415189743042 59.732032775879,17.4062843322754 59.7318572998047,17.4059352874755 59.7363433837891,17.4055862426757 59.7408332824707,17.4052391052247 59.7453193664551,17.3963317871094 59.745143890381,17.3959827423096 59.7496299743652,17.3956317901612 59.7541198730469,17.3952808380128 59.7586059570314,17.3949298858644 59.763095855713,17.3945789337158 59.7675819396973,17.3856639862062 59.7674064636231,17.3853130340577 59.7718925476074,17.3849601745605 59.7763786315919,17.3760452270508 59.7762031555176,17.3756923675538 59.780689239502,17.366771697998 59.7805137634277,17.3578567504884 59.7803344726564,17.3582134246827 59.7758445739747,17.3492965698243 59.7756652832031,17.3489418029786 59.7801551818848,17.3400211334228 59.779972076416,17.3311061859132 59.7797927856446,17.3307476043702 59.784278869629,17.3218288421631 59.7840995788574,17.3129119873047 59.7839164733886,17.3039932250977 59.7837333679199,17.304355621338 59.7792472839356,17.2954406738282 59.7790641784669,17.2865238189698 59.7788810729981,17.2776050567628 59.778694152832,17.2772407531739 59.7831840515137,17.2683238983155 59.7829971313477,17.2679557800294 59.7874870300294,17.2675876617432 59.7919731140137,17.258665084839 59.7917861938478,17.2582988739013 59.796272277832,17.2493782043458 59.7960891723633,17.2490062713623 59.8005752563478,17.2486362457277 59.805061340332,17.2397136688233 59.8048744201661,17.2393417358398 59.8093605041504,17.2389698028564 59.8138504028321,17.2300434112549 59.813663482666,17.2296695709229 59.8181495666504,17.2207431793213 59.8179626464843,17.2203693389893 59.8224487304688,17.2199935913087 59.8269348144531,17.2110633850098 59.8267478942872,17.2114391326904 59.8222579956055,17.2025146484375 59.8220710754394,17.1935863494874 59.8218803405761,17.1846599578859 59.8216896057128,17.1842803955079 59.8261756896973,17.1839008331299 59.8306617736816,17.1749706268311 59.8304710388184,17.1660404205323 59.8302803039551,17.1656589508058 59.8347663879395,17.1567306518555 59.8345756530762,17.156343460083 59.8390617370605,17.1559581756592 59.843547821045,17.1648921966553 59.8437385559083,17.1645107269287 59.8482284545899,17.1641273498536 59.8527145385742,17.1730632781982 59.8529052734375,17.1726818084717 59.8573951721191,17.163745880127 59.8572006225587,17.1633625030519 59.861686706543,17.1544246673585 59.8614959716797,17.145486831665 59.8613014221193,17.1451015472413 59.8657875061035,17.1447162628173 59.8702774047852,17.144329071045 59.8747634887696,17.135389328003 59.874568939209,17.1264476776124 59.8743743896486,17.1175060272218 59.8741798400879,17.1171169281007 59.8786659240724,17.1260585784913 59.8788604736328,17.1256713867188 59.8833465576173,17.1252822875977 59.8878326416016,17.1342277526857 59.8880271911622,17.1338405609131 59.8925170898439,17.133451461792 59.8970031738282,17.1330642700195 59.9014892578126,17.1326770782472 59.9059753417969,17.1322879791261 59.9104614257812,17.1319007873536 59.9149513244628,17.1315135955811 59.9194374084473,17.13112449646 59.9239234924316,17.1307353973389 59.9284095764161,17.1303482055665 59.9328956604004,17.1299591064454 59.937385559082,17.1295680999756 59.9418716430665,17.1385288238526 59.942066192627,17.1381416320801 59.9465522766114,17.1377544403076 59.9510383605957,17.1287918090821 59.9508438110352,17.1284027099611 59.9553298950195,17.1280136108399 59.9598197937012,17.1276245117188 59.9643058776857,17.118658065796 59.964111328125,17.1096935272218 59.9639129638672,17.1007289886476 59.9637184143067,17.0917644500734 59.9635200500489,17.0827999114991 59.9633216857911,17.0824012756347 59.9678077697754,17.0820083618165 59.972297668457,17.0816116333008 59.9767837524415,17.0812168121338 59.9812698364258,17.0901870727539 59.9814682006836,17.0897903442383 59.9859542846681,17.098762512207 59.9861526489259,17.1077346801758 59.9863471984863,17.1167068481446 59.9865455627441,17.1163139343263 59.9910316467286,17.125286102295 59.9912261962891,17.1342601776124 59.9914207458497,17.1432323455812 59.9916152954102,17.1522064208985 59.9918098449706,17.151819229126 59.9962959289551,17.1607933044433 59.9964866638184,17.1604290008546 60.000732421875,17.1604080200196 60.0009765625001,17.1600208282471 60.0054626464843,17.1689987182618 60.0056533813476,17.1686134338378 60.0101432800293,17.1775913238525 60.0103340148926,17.1772079467774 60.014820098877,17.1861877441407 60.0150108337403,17.1858062744141 60.0194969177246,17.1854248046876 60.0239868164062,17.1944046020509 60.0241775512695,17.1940250396729 60.028663635254,17.2030067443848 60.0288543701172,17.2026271820068 60.0333404541016,17.2022495269776 60.0378265380861,17.2112331390381 60.0380172729493,17.2202205657959 60.0382080078126,17.2205963134766 60.0337181091309,17.2295818328858 60.0339088439942,17.238567352295 60.0340957641602,17.2475509643555 60.0342826843262,17.2479248046875 60.0297966003418,17.256908416748 60.0299835205079,17.2565383911133 60.0344696044922,17.2655220031738 60.0346565246583,17.2745056152345 60.034839630127,17.2834911346436 60.0350265502929,17.2831249237061 60.0395126342774,17.282751083374 60.0439987182617,17.2917404174805 60.0441818237304,17.2913722991944 60.0486717224121,17.3003616333008 60.0488548278808,17.2999954223633 60.0533409118653,17.2996273040772 60.0578308105469,17.3086185455322 60.0580139160157,17.3082523345948 60.0625,17.3078861236573 60.0669860839844,17.3075199127198 60.0714759826661,17.3071537017823 60.0759620666504,17.3067874908448 60.0804481506348,17.3064193725585 60.0849380493165,17.3060531616211 60.0894241333008,17.3056869506836 60.0939102172853,17.3053188323975 60.0984001159669,17.30495262146 60.1028861999512,17.3139553070069 60.1030693054199,17.3135890960694 60.1075553894044,17.3225955963135 60.1077384948732,17.322229385376 60.1122245788574,17.3218631744386 60.1167144775391,17.3215007781982 60.1212005615236,17.3211345672608 60.1256866455078,17.3301448822022 60.1258697509766,17.3297805786133 60.1303558349611,17.338794708252 60.1305389404298,17.3384284973145 60.1350250244141,17.3474426269531 60.1352043151857,17.347080230713 60.1396942138673,17.3560943603516 60.1398735046387,17.3651084899902 60.1400527954102,17.3647518157959 60.1445388793945,17.3737659454347 60.1447181701661,17.3741226196288 60.1402320861816,17.374481201172 60.1357421875,17.3834953308106 60.1359214782715,17.3925075531006 60.1360969543458,17.4015216827393 60.1362762451173,17.4105358123779 60.1364517211915,17.4101829528809 60.1409378051758,17.4098281860352 60.1454277038574,17.4094734191896 60.1499137878419,17.4184932708741 60.1500892639161,17.4275093078614 60.1502647399903,17.4365272521973 60.1504402160645,17.4455451965331 60.1506118774413,17.4451942443848 60.155101776123,17.4542160034181 60.1552734375001,17.4538707733154 60.1597633361817,17.4448471069337 60.1595878601075,17.4444980621339 60.1640777587891,17.4535217285156 60.164249420166,17.4625415802002 60.164421081543,17.462194442749 60.1689109802247,17.4712181091309 60.1690826416017,17.4708728790283 60.173568725586,17.4798965454102 60.173740386963,17.4795532226564 60.1782302856446,17.4885768890381 60.1783981323243,17.488920211792 60.1739120483398,17.4892654418946 60.1694259643555,17.4896068572999 60.1649360656739,17.4899501800538 60.1604499816895,17.4989681243898 60.1606178283691,17.4993114471436 60.1561317443848,17.4996528625489 60.1516418457032,17.4999942779542 60.1471557617189,17.5003376007081 60.1426658630372,17.5093517303467 60.1428375244141,17.5096893310548 60.1383476257324,17.5100307464601 60.1338615417482,17.5103721618653 60.1293716430665,17.5107116699219 60.124885559082,17.5197238922119 60.1250534057617,17.5200595855714 60.12056350708,17.5290699005127 60.1207313537599,17.5294075012208 60.1162452697754,17.5297412872315 60.1117553710938,17.538751602173 60.1119232177734,17.5390872955323 60.1074371337891,17.5394248962402 60.1029472351075,17.5484294891357 60.1031150817872,17.5487613677979 60.0986289978027,17.54909324646 60.094139099121,17.5580978393555 60.0943069458009,17.5584316253663 60.0898170471193,17.5674324035644 60.0899810791016,17.5764350891113 60.0901489257812,17.5767650604249 60.0856590270996,17.577096939087 60.0811729431153,17.586093902588 60.0813369750978,17.5950927734376 60.0814971923829,17.5947666168213 60.0859870910646,17.5944385528566 60.0904769897462,17.6034393310547 60.0906372070313,17.6124439239502 60.0908012390136,17.6214447021485 60.0909614562989,17.6211185455323 60.0954513549806,17.6207962036133 60.0999374389648,17.6204719543457 60.1044273376465,17.6201496124268 60.1089172363282,17.6291522979737 60.1090774536133,17.638162612915 60.1092376708984,17.6471691131593 60.1093978881835,17.6468486785889 60.113883972168,17.6558570861817 60.1140441894531,17.6648654937744 60.1142044067383,17.6738758087158 60.1143608093262,17.6735572814942 60.1188507080079,17.6825675964356 60.1190071105958,17.6915798187256 60.1191635131836,17.691261291504 60.1236534118652,17.7002754211426 60.1238098144532,17.7092857360841 60.1239662170411,17.7182960510253 60.1241226196289,17.717987060547 60.1286087036133,17.7176742553711 60.133098602295,17.7266902923585 60.1332511901856,17.726999282837 60.1287651062011,17.7360134124756 60.1289176940919,17.7450256347657 60.1290702819825,17.7453327178955 60.124584197998,17.745641708374 60.1200942993163,17.7546520233154 60.1202468872071,17.7636623382569 60.1203994750977,17.7726726531984 60.1205520629883,17.7723693847656 60.1250381469726,17.7813816070556 60.1251907348634,17.781078338623 60.129680633545,17.7900924682618 60.1298294067383,17.7897911071778 60.1343193054199,17.7988052368165 60.1344680786133,17.7985076904296 60.138957977295,17.8075218200685 60.1391067504884,17.8165378570557 60.1392555236816,17.8255538940431 60.139404296875,17.8258514404297 60.1349143981934,17.8348655700684 60.1350593566894,17.8438816070557 60.1352081298828,17.8441753387452 60.1307182312012,17.8531894683838 60.1308670043946,17.8534832000733 60.1263771057129,17.8537769317628 60.1218872070313,17.8540687561036 60.1173973083497,17.8543624877931 60.1129112243653,17.8546524047852 60.1084213256837,17.8456459045411 60.1082763671875,17.8459396362305 60.1037864685058,17.8462314605712 60.0992965698242,17.8465251922607 60.0948104858399,17.855531692505 60.0949554443359,17.8645324707031 60.095100402832,17.8735370635986 60.0952453613282,17.8825435638429 60.0953903198243,17.8915481567384 60.0955314636232,17.8912601470947 60.1000213623048,17.8909740447997 60.1045112609864,17.8999805450441 60.1046524047852,17.900266647339 60.1001625061035,17.9005527496339 60.0956764221192,17.9008388519288 60.0911865234376,17.9011249542237 60.0866966247559,17.9014110565187 60.0822067260743,17.9104118347168 60.0823516845703,17.9106941223145 60.0778617858887,17.9016952514648 60.07772064209,17.9019813537597 60.0732307434083,17.8929824829102 60.0730857849121,17.8932704925537 60.0685997009278,17.8935565948486 60.0641098022462,17.8938426971436 60.0596199035645,17.9028396606445 60.0597648620605,17.9031238555908 60.0552749633789,17.9121170043946 60.0554161071778,17.9211101531982 60.0555572509766,17.930103302002 60.0556983947755,17.9390983581544 60.0558395385742,17.9480934143068 60.0559768676759,17.9570865631104 60.0561180114746,17.9573650360107 60.051628112793,17.9663581848145 60.0517654418946,17.9753513336183 60.0519027709962,17.9843444824219 60.0520401000977,17.9846172332763 60.0475540161134,17.9936103820801 60.0476875305177,17.9938831329346 60.0432014465333,17.9941577911378 60.0387115478516,17.9944286346436 60.0342216491699,18.0034160614014 60.0343589782714,18.0036888122559 60.0298690795898,18.0126743316651 60.0300025939941,18.012945175171 60.0255126953125,18.0132141113282 60.0210266113282,18.0221996307372 60.0211601257325,18.0224685668945 60.0166702270509,18.0314521789552 60.016803741455,18.0404357910157 60.0169372558594,18.0494194030761 60.0170707702637,18.0491542816162 60.0215606689454,18.0488872528076 60.026050567627,18.0578765869142 60.026180267334,18.0668601989747 60.0263137817383,18.0665988922119 60.03080368042,18.0663375854492 60.0352897644044,18.0660743713379 60.0397796630859,18.0750637054443 60.0399131774902,18.0840549468995 60.0400428771974,18.093044281006 60.0401725769044,18.0933036804199 60.0356826782227,18.1022930145263 60.0358123779297,18.1112823486329 60.0359382629395,18.1202716827394 60.0360679626464,18.1205272674561 60.0315780639648,18.1295146942139 60.0317039489746,18.1385040283204 60.0318336486818,18.1387577056885 60.0273437500001,18.1477432250976 60.0274696350099,18.1567306518555 60.0275955200195,18.1657180786133 60.0277175903321,18.1747035980225 60.0278434753419,18.1749534606934 60.0233535766603,18.183937072754 60.0234756469727,18.1929244995118 60.0236015319825,18.1931705474855 60.0191116333008,18.202154159546 60.0192337036133,18.2111396789552 60.0193557739259,18.2201232910157 60.0194778442383,18.2291107177735 60.0195960998536,18.2293491363526 60.0151062011719,18.2383346557617 60.0152282714844,18.238094329834 60.019718170166,18.2378559112549 60.0242042541505,18.2468414306641 60.0243263244629,18.2558288574219 60.0244445800782,18.2648162841798 60.0245628356934,18.2645797729493 60.0290527343751,18.2735671997071 60.0291709899903,18.2825565338135 60.0292854309083,18.2915420532228 60.0294036865235,18.3005313873292 60.0295181274414,18.3095207214356 60.0296325683595,18.3185081481935 60.0297470092773,18.3274974822999 60.0298614501953,18.3364849090577 60.0299758911133,18.3362579345703 60.034465789795,18.3360328674317 60.0389556884766,18.3358058929443 60.0434455871583,18.3268146514893 60.0433311462402,18.3265857696534 60.0478210449219,18.326358795166 60.0523109436035,18.3261318206788 60.0568008422852,18.3351268768311 60.0569152832032,18.3441238403321 60.0570259094239,18.3531188964845 60.0571403503419,18.3621139526368 60.0572509765626,18.3623371124269 60.0527610778809,18.3713302612305 60.0528717041016,18.3803272247314 60.0529823303223,18.3893203735352 60.0530929565431,18.3895397186279 60.0486030578614,18.3985347747803 60.0487098693848,18.3987503051757 60.0442199707031,18.3989696502686 60.0397300720215,18.3991870880126 60.0352401733398,18.3994064331055 60.0307502746582,18.4083938598633 60.0308570861817,18.4086093902588 60.0263671875001,18.4175987243652 60.0264778137208,18.4178123474122 60.0219879150391,18.4267978668214 60.0220947265625,18.4357852935792 60.0222015380861,18.4359970092773 60.0177116394044,18.444980621338 60.0178146362306,18.4451923370361 60.0133247375489,18.4541778564454 60.0134315490723,18.4631633758544 60.0135345458984,18.4633712768556 60.0090446472168,18.4723548889161 60.0091514587403,18.4725646972656 60.0046577453613,18.4815464019777 60.0047645568849,18.4817008972169 60.0013732910157,18.4817504882812 60.0002746582032,18.4727687835693 60.0001678466797,18.4729766845703 59.995677947998,18.4731826782227 59.9911880493164,18.4733905792236 59.9866981506348,18.4644165039062 59.9865951538086,18.455436706543 59.9864921569824,18.446460723877 59.986385345459,18.4466705322266 59.9818954467774,18.4376964569092 59.981788635254,18.4379081726075 59.9772987365724,18.4289321899414 59.9771919250488,18.4291458129883 59.9727020263672,18.4293594360352 59.9682121276855,18.4295711517335 59.9637222290039,18.4297847747802 59.9592323303223,18.4299983978271 59.9547424316406,18.4302101135254 59.950252532959,18.4212436676026 59.9501457214356,18.4122772216798 59.9500389099121,18.4033107757568 59.9499320983887,18.3943405151368 59.949821472168,18.3945598602295 59.9453315734863,18.3947772979737 59.9408416748047,18.3858146667481 59.940731048584,18.3860321044922 59.9362411499023,18.3862495422363 59.9317512512207,18.3772888183594 59.9316444396973,18.3775081634523 59.9271545410157,18.3864688873291 59.927261352539,18.386688232422 59.9227714538574,18.3869075775146 59.9182815551757,18.3871269226075 59.9137916564943,18.387342453003 59.9093017578126,18.3962993621827 59.9094123840331,18.3965167999267 59.9049224853517,18.3967323303224 59.90043258667,18.3969497680665 59.8959426879884,18.397165298462 59.8914527893068,18.4061183929444 59.8915596008301,18.4063320159912 59.8870697021484,18.4065475463868 59.8825798034668,18.3976001739503 59.8824729919435,18.3886508941652 59.8823623657227,18.3888683319092 59.8778724670411,18.3799209594727 59.8777656555175,18.3801403045655 59.8732757568359,18.3711948394775 59.8731651306153,18.3714122772218 59.8686752319337,18.3624687194824 59.868564605713,18.3626918792725 59.8640747070314,18.3629112243653 59.8595848083497,18.3631324768068 59.855094909668,18.3541908264161 59.85498046875,18.3452510833741 59.8548698425292,18.3363094329835 59.8547554016114,18.3365364074707 59.8502693176271,18.3275947570801 59.850154876709,18.3186569213867 59.8500404357911,18.3097152709961 59.849925994873,18.3007755279541 59.8498115539551,18.30100440979 59.8453216552735,18.2920665740968 59.8452072143556,18.2831287384034 59.8450889587403,18.27419090271 59.8449745178223,18.2744255065919 59.8404846191406,18.2654857635499 59.8403663635253,18.2657203674316 59.8358764648439,18.2659549713135 59.8313865661622,18.2570190429689 59.831268310547,18.2572555541992 59.8267784118653,18.2483215332031 59.8266601562501,18.2393894195557 59.8265419006348,18.2396278381348 59.8220520019532,18.2306957244873 59.8219299316407,18.2217617034912 59.8218116760254,18.2128314971923 59.8216896057128,18.203899383545 59.8215675354004,18.2036571502686 59.8260574340821,18.1947231292725 59.8259353637696,18.1949672698976 59.821445465088,18.1860351562501 59.8213233947754,18.1771049499512 59.8212013244629,18.1773529052734 59.8167114257813,18.168420791626 59.8165855407715,18.1594905853273 59.816463470459,18.1505603790284 59.8163375854493,18.1508083343506 59.8118476867676,18.1418781280517 59.8117218017578,18.1329517364502 59.811595916748,18.1332035064698 59.8071060180664,18.1334552764894 59.8026161193847,18.1304626464844 59.8025741577148)
            //             ),
            //             (
            //                 (17.7897911071778 60.1343193054199,17.780776977539 60.1341667175293,17.7804737091064 60.1386566162109,17.7894916534424 60.1388053894044,17.7897911071778 60.1343193054199)
            //             )
            //         )"
            //      ),
            //     "properties" => array(
            //         "name" => "Uppsala",
            //         "code" => "SE.UP.UP"
            //     )
            // );
            // // print_r(json_encode($geoJson));
            // print_r($geoJson);

            echo "<script>";
            echo "var areas = JSON.parse('" . json_encode($geoJson) . "');";





        }

        function toGeoJson($string){
            $parser = new ParensParser();
            $pattern = '/[a-zA-Z]+/';
            $matches = array();
            if(preg_match($pattern, $string, $matches)){
                $match = array_pop($matches);
                $type = "";
                $coordinates = array();
                switch($match){
                    case "MULTIPOLYGON":
                        $type = "MultiPolygon"; break;
                    case "POLYGON";
                        $type = "Polygon"; break;

                }

                $cString = substr($string, strlen($match));
                // $cString = substr($cString, 1, -1);
                $coordinates = coordinatesToArray($parser->parse($cString));
                // $coordinates = $parser->parse($cString);

                return array("type" => $type, "coordinates" => $coordinates);
            } else {
                return array();
            }
        }

        // $string ex: (((0 0,4 0,4 4,0 4,0 0),(1 1,2 1,2 2,1 2,1 1)), ((-1 -1,-1 -2,-2 -2,-2 -1,-1 -1)))

        function coordinatesToArray($nested_array){
            $coords = array();
            if(gettype($nested_array) == "array" && gettype($nested_array[0]) == "string"){
                $coords = coordinatesToArray($nested_array[0]);
            } else if(gettype($nested_array) == "array"){
                foreach($nested_array as $i => $child){
                    $coords[] = coordinatesToArray($child);
                }
            } else {
                $coords = explode(",", $nested_array);
                foreach($coords as $j => $coord){
                    // $coords[$j] = str_replace(" ", ",", $coord);

                    $coords[$j] = explode(" ", trim($coord));
                    foreach($coords[$j] as $k => $lonlat){
                        $coords[$j][$k] = floatval($lonlat);
                    }
                }
            }
            return $coords;
        }

        function coordinatesToArray_old($nested_array){
            $coordinates = array();
            foreach($nested_array as $i => $value){
                if($value != ","){
                    if(gettype($value) == "array"){
                        $coordinates[] = coordinatesToArray($value);
                    } else {
                        $coords = explode(",", $value);
                        foreach($coords as $j => $coord){
                            // $coords[$j] = str_replace(" ", ",", $coord);

                            $coords[$j] = explode(" ", trim($coord));
                            foreach($coords[$j] as $k => $lonlat){
                                $coords[$j][$k] = floatval($lonlat);
                            }
                        }
                        $coordinates[] = $coords;
                    }
                }
            }
            return $coordinates;
        }


        ?>
        </script>
    </body>
</html>
